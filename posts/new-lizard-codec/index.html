<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>The Lizard Codec | Blosc Main Blog Page </title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../../rss.xml">
<link rel="canonical" href="http://blosc.org/posts/new-lizard-codec/">
<link rel="icon" href="../../blosc-favicon_16x16.png" sizes="16x16">
<link rel="icon" href="../../blosc-favicon_32x32.png" sizes="32x32">
<link rel="icon" href="../../blosc-favicon_64x64.png" sizes="64x64">
<link rel="icon" href="../../blosc-favicon_128x128.png" sizes="128x128">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-111342564-2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-111342564-2');
</script><meta name="author" content="Francesc Alted">
<link rel="prev" href="../codecs-pgo/" title="Testing PGO with LZ4 and Zstd codecs" type="text/html">
<link rel="next" href="../prize-push-Blosc2/" title="Blosc Has Won Google's Open Source Peer Bonus Program" type="text/html">
<meta property="og:site_name" content="Blosc Main Blog Page ">
<meta property="og:title" content="The Lizard Codec">
<meta property="og:url" content="http://blosc.org/posts/new-lizard-codec/">
<meta property="og:description" content="The past weekend I was putting some time in integrating one of the codecs that I was lately more curious about (specially since the release of its 1.0 version some months ago).  I am talking about Liz">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2017-07-31T17:32:20Z">
<meta property="article:tag" content="Lizard">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="http://blosc.org/">
                <img src="../../blosc-logo_128.png" alt="Blosc Main Blog Page " id="logo"></a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../pages/blosc-in-depth/">Blosc In Depth</a>
                </li>
<li>
<a href="../../pages/synthetic-benchmarks/">Benchmarks</a>
                </li>
<li>
<a href="../../pages/donate/">Donate to Blosc</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">The Lizard Codec</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../authors/francesc-alted/">Francesc Alted</a>
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2017-07-31T17:32:20Z" itemprop="datePublished" title="2017-07-31 17:32">2017-07-31 17:32</time></a>
            </p>
                <p class="commentline">
        
    <a href="#disqus_thread" data-disqus-identifier="cache/posts/the-lizard-codec.html">Comments</a>


            

        </p>
</div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
<p>The past weekend I was putting some time in integrating one of the codecs that I was lately more curious about (specially since the release of its 1.0 version some months ago).  I am talking about <a class="reference external" href="https://github.com/inikep/lizard">Lizard</a>, a direct derivative of the LZ4 codec and whose author is Przemyslaw Skibinski.  One should remark that Przemyslaw is not new in the compression arena as he has helped Yann Collet quite a lot during the <a class="reference external" href="https://github.com/facebook/zstd">Zstandard</a> development, and also he is the author of <a class="reference external" href="https://github.com/inikep/lzbench">lzbench</a>, a nice and comprehensive in-memory benchmark of a series of open-source LZ77/LZSS/LZMA compressors.</p>
<p>The reason why I was thinking that Lizard was an interesting codec for Blosc is because it mixes some interesting optimizations of the LZ4 codec and, optionally, it can use them in combination with the <a class="reference external" href="http://www.geeksforgeeks.org/greedy-algorithms-set-3-huffman-coding/">Huffman coding</a> by selecting different compression levels (currently from 10 to 49).</p>
<p>After the initial support for Lizard in Blosc, it took me some time to determine a decent map between the compression levels in Blosc (1-9) to the ones in Lizard (10-49), mainly for allowing fast compression and decompression (what Blosc is all about).  During the way, I discovered that the most interesting compression levels in Lizard have been  <a class="reference external" href="https://github.com/Blosc/c-blosc2/blob/lizard/blosc/blosc.c#L606-L625">10, 20 and 41</a>.  This was indeed determined using the <a class="reference external" href="https://github.com/Blosc/c-blosc2/blob/master/bench/bench.c">synthetic benchamrk</a> that comes with Blosc, but that is the usual path that gaves me quite good estimates for a first calibration (we are working on a more complete tuner that can adapt to actual data in real time, but I'll blog about it in another occasion).</p>
<div class="section" id="a-new-star-has-born">
<h2>A new star has born</h2>
<p>After the calibration was done the results of the new codec are really surprising:</p>
<table>
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<tbody><tr>
<td><p><img alt="lizard-c" src="../../images/the-lizard-codec/lizard-suite-8p-compr.png"></p></td>
<td><p><img alt="lizard-d" src="../../images/the-lizard-codec/lizard-suite-8p-decompr.png"></p></td>
</tr></tbody>
</table>
<p>The interesting part of Lizard can be seen when large compression levels for Blosc are used, specially 8 and 9.  Those are mapped to compression level 41 in Lizard, which means that the LIZv1 + Huffman compression method is used.  Following the documentation, this matches the compression levels of Zlib and Zstd/Brotli, and it shows.</p>
<p>Just for reference, here it is the performance of the LZ4 codec, from which Lizard inherits a good part of its code:</p>
<table>
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<tbody><tr>
<td><p><img alt="lz4-c" src="../../images/codecs-pgo/lz4-comp-gcc-6.3.png"></p></td>
<td><p><img alt="lz4-d" src="../../images/codecs-pgo/lz4-decomp-gcc-6.3.png"></p></td>
</tr></tbody>
</table>
<p>And here the performance of Zstd, which also uses Huffman coding:</p>
<table>
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<tbody><tr>
<td><p><img alt="zstd-c" src="../../images/codecs-pgo/zstd-comp-gcc-6.3.png"></p></td>
<td><p><img alt="zstd-d" src="../../images/codecs-pgo/zstd-decomp-gcc-6.3.png"></p></td>
</tr></tbody>
</table>
<p>So, while Lizard (or at least, the current mapping that I did for it inside Blosc) in low compression levels cannot beat the speed of LZ4 or the compression ratios of Zstd, for high compression levels it clearly beats LZ4 and Zstd speed both for compression and decompression.  Most specially, it works extremely well for achieving pretty reasonable compression ratios (typically better than Zlib, albeit not as good as Zstd) at very good decompression speed and exceptional compression speed (compressing at more than the memcpy() speed, at very good ratios, oh really?).</p>
<p>Finally, for those wondering why I have not used the LIZv1 + Huffman compression method also for the lower compression levels in Blosc, the answer is that I obviously tried that, but for some reason, this method only performs well for large buffers, whereas for small buffers (like the ones created by low compression levels in Blosc) its performance is rather poor.  I was kind of getting a similar behaviour with Zstd, where performance shines for decompressing large buffers (the difference is that Lizard can compress at tremendous speed when compared with Zstd in this scenario), so I suppose this is typical when Huffman methods are used.</p>
</div>
<div class="section" id="finding-its-place-among-blosc-codecs">
<h2>Finding its place among Blosc codecs</h2>
<p>In my previous blog, I was saying that Zstd has virtually no competitor in Write Once Read Multiple scenarios.  However, I think there is still a niche for codecs that, without providing the extreme compression ratios of Zstd, they still show big enough compression muscle without loosing too much compression speed.  IMO, this is a good description of how Lizard performs.  However, in Blosc1 we only have slots for a couple of codecs more (but that will not be a problem for Blosc2, where much more codecs will be supported), and although I am pretty enthusiastic on adding Lizard it would be nice to gather users feedback before than that.  So in case you are a Blosc user, please use the <a class="reference external" href="https://github.com/Blosc/c-blosc/tree/lizard">lizard branch</a> of the C-Blosc repo (<a class="reference external" href="https://github.com/Blosc/c-blosc2/pull/21">UPDATE: Lizard has been merged into the C-Blosc2 repo recently</a>) and report back your results.</p>
</div>
<div class="section" id="appendix-hardware-and-software-used">
<h2>Appendix: Hardware and software used</h2>
<p>For reference, here it is the configuration that I used for producing the plots in this blog entry.</p>
<ul class="simple">
<li><p>CPU: Intel Xeon E3-1245 v5 @ 3.50GHz (4 physical cores with hyper-threading)</p></li>
<li><p>OS:  Ubuntu 16.04</p></li>
<li><p>Compiler: GCC 6.3.0</p></li>
<li><p>C-Blosc2: 2.0.0a4.dev (2017-07-29, lizard branch)</p></li>
<li><p>Lizard: 1.0.0</p></li>
</ul>
</div>
</div>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/lizard/" rel="tag">Lizard</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../codecs-pgo/" rel="prev" title="Testing PGO with LZ4 and Zstd codecs">Previous post</a>
            </li>
            <li class="next">
                <a href="../prize-push-Blosc2/" rel="next" title="Blosc Has Won Google's Open Source Peer Bonus Program">Next post</a>
            </li>
        </ul></nav></aside><section class="comments hidden-print"><h2>Comments</h2>
        
        
        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="blosc",
            disqus_url="http://blosc.org/posts/new-lizard-codec/",
        disqus_title="The Lizard Codec",
        disqus_identifier="cache/posts/the-lizard-codec.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        </section></article><script>var disqus_shortname="blosc";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2021         <a href="mailto:blosc@blosc.org">The Blosc Developers</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script>
</body>
</html>
