<p>In order to assess the performance of Blosc in a variety of scenarios, a
benchmark program is provided. This should enable a fair comparison between
different hardware and software platforms.  In this section, a series of plots
about the performance of Blosc on a selected set of platforms are shown.  It is
fun to see the evolution of the hardware/software in recent years in terms of
the speed of Blosc compared to a plain OS <tt class="docutils literal">memcpy()</tt>.  These conclusions can
be applied to the evolution of the ratio of computing power versus memory
bandwidth in general.</p>
<p>Many users have contributed their own benchmarks and you can view
them all in the next links:</p>
<ul class="simple">
<li><a class="reference external" href="/pages/benchmarks-blosclz/">Benchmarks for BloscLZ</a></li>
<li><a class="reference external" href="/pages/benchmarks-lz4/">Benchmarks for LZ4</a></li>
<li><a class="reference external" href="/pages/benchmarks-lz4hc/">Benchmarks for LZ4HC</a></li>
<li><a class="reference external" href="/pages/benchmarks-snappy/">Benchmarks for Snappy</a></li>
<li><a class="reference external" href="/pages/benchmarks-zlib/">Benchmarks for Zlib</a></li>
</ul>
<p>In case you want to contribute and run the benchmarks your own platform, follow
the instructions below on how to compile, run and report back the results of
the benchmark.</p>
<div class="section" id="how-to-compile-or-get-binaries-for-the-benchmark-suite-for-blosc">
<h1>How to compile (or get binaries for) the benchmark suite for Blosc</h1>
<p>First, checkout the master version from:</p>
<p><a class="reference external" href="https://github.com/Blosc/c-blosc">https://github.com/Blosc/c-blosc</a></p>
<p>Then, compile the sources:</p>
<p><em>GCC/Clang (Unix) or MINGW/Clang (Windows)</em></p>
<pre class="code console"><a name="rest_code_bc1f1b70afa847c6a27f1b7a001b6874-1"></a><span class="gp">$</span> <span class="nb">cd</span> your_blosc_sources
<a name="rest_code_bc1f1b70afa847c6a27f1b7a001b6874-2"></a><span class="gp">$</span> mkdir build
<a name="rest_code_bc1f1b70afa847c6a27f1b7a001b6874-3"></a><span class="gp">$</span> <span class="nb">cd</span> build
<a name="rest_code_bc1f1b70afa847c6a27f1b7a001b6874-4"></a><span class="gp">$</span> cmake ..
<a name="rest_code_bc1f1b70afa847c6a27f1b7a001b6874-5"></a><span class="gp">$</span> make  <span class="c1"># the benchmark will appear in `your_blosc_sources`/build/bench</span>
<a name="rest_code_bc1f1b70afa847c6a27f1b7a001b6874-6"></a><span class="gp">$</span> cp bench/bench ../bench
<a name="rest_code_bc1f1b70afa847c6a27f1b7a001b6874-7"></a><span class="gp">$</span> <span class="nb">cd</span> ../bench
</pre></div>
<div class="section" id="running-and-plotting-the-different-suites-in-benchmark">
<h1>Running and plotting the different suites in benchmark</h1>
<p>Now that you have the executable benchmark, you can run it by passing
the <tt class="docutils literal">suite</tt> parameter followed by the number of cores in your machine
to the <tt class="docutils literal">bench</tt> program, i.e. something like:</p>
<pre class="code console"><a name="rest_code_c908edac496342ab94ddde3c00b39343-1"></a><span class="gp">$</span> ./bench <span class="nv">$CODEC</span> suite <span class="o">[</span>nthreads<span class="o">]</span>  <span class="c1"># $CODEC can be any of blosclz, lz4, lz4hc, snappy, zlib</span>
</pre><p>then a small suite will be run that checks the speed of Blosc for the
specified number of threads.  Given this output, you can convert it
into a plot by using the <tt class="docutils literal"><span class="pre">bench/plot-speeds.py</span></tt> scripts (you will need
the [<a class="reference external" href="http://matplotlib.sourceforge.net/">http://matplotlib.sourceforge.net/</a> matplotlib] library
installed).  You can print a small online help for this script usage:</p>
<pre class="code console"><a name="rest_code_7afae34fc6b64b65908dcc57da3f8cb1-1"></a><span class="gp">$</span> python plot-speeds.py -h
<a name="rest_code_7afae34fc6b64b65908dcc57da3f8cb1-2"></a><span class="go">Usage: plot-speeds.py [-r] [-o outfile] [-t title ] [-d|-c] filename</span>
<a name="rest_code_7afae34fc6b64b65908dcc57da3f8cb1-3"></a>
<a name="rest_code_7afae34fc6b64b65908dcc57da3f8cb1-4"></a><span class="go">Options:</span>
<a name="rest_code_7afae34fc6b64b65908dcc57da3f8cb1-5"></a><span class="go">  -h, --help            show this help message and exit</span>
<a name="rest_code_7afae34fc6b64b65908dcc57da3f8cb1-6"></a><span class="go">  -o OUTFILE, --outfile=OUTFILE</span>
<a name="rest_code_7afae34fc6b64b65908dcc57da3f8cb1-7"></a><span class="go">                        filename for output (many extensions supported, e.g.</span>
<a name="rest_code_7afae34fc6b64b65908dcc57da3f8cb1-8"></a><span class="go">                        .png, .jpg, .pdf)</span>
<a name="rest_code_7afae34fc6b64b65908dcc57da3f8cb1-9"></a><span class="go">  -t TITLE, --title=TITLE</span>
<a name="rest_code_7afae34fc6b64b65908dcc57da3f8cb1-10"></a><span class="go">                        title of the plot</span>
<a name="rest_code_7afae34fc6b64b65908dcc57da3f8cb1-11"></a><span class="go">  -l LIMIT, --limit=LIMIT</span>
<a name="rest_code_7afae34fc6b64b65908dcc57da3f8cb1-12"></a><span class="go">                        expression to limit number of threads shown</span>
<a name="rest_code_7afae34fc6b64b65908dcc57da3f8cb1-13"></a><span class="go">  -x XMAX, --xmax=XMAX  limit the x-axis</span>
<a name="rest_code_7afae34fc6b64b65908dcc57da3f8cb1-14"></a><span class="go">  -r, --report          generate file for reporting</span>
<a name="rest_code_7afae34fc6b64b65908dcc57da3f8cb1-15"></a><span class="go">  -d, --decompress      plot decompression data</span>
<a name="rest_code_7afae34fc6b64b65908dcc57da3f8cb1-16"></a><span class="go">  -c, --compress        plot compression data</span>
</pre><p>For example, if you have, say, 4 cores in your machine, and want to
get the plots interactively, proceed like this:</p>
<pre class="code console"><a name="rest_code_bd7f509448bf4682a96e7bfe28b9835b-1"></a><span class="gp">$</span> ./bench blosclz suite <span class="m">4</span> &gt; blosclz.txt
<a name="rest_code_bd7f509448bf4682a96e7bfe28b9835b-2"></a><span class="gp">$</span> python plot-speeds.py -c blosclz.txt   <span class="c1"># get the compression plot</span>
<a name="rest_code_bd7f509448bf4682a96e7bfe28b9835b-3"></a><span class="gp">$</span> python plot-speeds.py -d blosclz.txt   <span class="c1"># get the decompression one</span>
</pre><p>Alternatively, you can directly get a plot file by using the <tt class="docutils literal"><span class="pre">-o</span></tt>
flag:</p>
<pre class="code console"><a name="rest_code_39e699ebd9374101a2c87e5ebb80791d-1"></a><span class="gp">$</span> python plot-speeds.py -o plot.png -c mysuite-blosclz.txt
</pre><p>Or, you can get a nice plot apt for reporting and publication on this site
with:</p>
<pre class="code console"><a name="rest_code_d54dec1b3b314752b331b11dfaa720cb-1"></a><span class="gp">$</span> python plot-speeds.py -r -c blosclz.txt  <span class="c1"># gives blosclz-compr.png</span>
<a name="rest_code_d54dec1b3b314752b331b11dfaa720cb-2"></a><span class="gp">$</span> python plot-speeds.py -r -d blosclz.txt  <span class="c1"># gives blosclz-decompr.png</span>
</pre><p>Sometimes the legend may cover some of the data in this case you can
increase the limit of the x-axis (compression ratio) using the <tt class="docutils literal"><span class="pre">-x</span></tt>
switch (<cite>10</cite> is quite a good value):</p>
<pre class="code console"><a name="rest_code_a008381f405c4612a3ed2965f70f6f27-1"></a><span class="gp">$</span> python plot-speeds.py -x <span class="m">10</span> -c mysuite.txt
</pre><p>If you have many, many threads, the output can become quite confusing
and you may want to take a look at the <tt class="docutils literal"><span class="pre">-l</span></tt> switch. This can limit the
number of displayed threads using an arbitrary Python expression, like
a list or an iterator over <tt class="docutils literal">ints</tt> (indexing starts at 1, not 0):</p>
<pre class="code console"><a name="rest_code_14646015de4b43a78032af0ac4a7a374-1"></a><span class="gp">$</span> python plot-speeds.py -l <span class="s1">&#39;[1]&#39;</span> -c mysuite.txt
<a name="rest_code_14646015de4b43a78032af0ac4a7a374-2"></a><span class="gp">$</span> python plot-speeds.py -l <span class="s1">&#39;range(1, 8)&#39;</span> mysuite.txt
<a name="rest_code_14646015de4b43a78032af0ac4a7a374-3"></a><span class="gp">$</span> python plot-speeds.py -l <span class="s1">&#39;range(1, 8, 2)&#39;</span> mysuite.txt
<a name="rest_code_14646015de4b43a78032af0ac4a7a374-4"></a><span class="gp">$</span> python plot-speeds.py -l <span class="s1">&#39;[1, 3, 28]&#39;</span> mysuite.txt
</pre></div>
<div class="section" id="reporting-your-results-back">
<h1>Reporting your results back</h1>
<p>If you want to help with fine-tuning Blosc for other processors, please send
the output of the suite to <a class="reference external" href="http://groups.google.com/group/blosc">the mailing list</a>.  That info will be extremely useful
to help us improve Blosc so that it can achieve better compression ratios
and performance in future versions.  Please be sure that you also provide the
following information (as a minimum):</p>
<ul class="simple">
<li>CPU info: (vendor, model or cache sizes)</li>
<li>Operating System: (e.g. Linux/Windows/MacOSX/Solaris and version)</li>
<li>Compiler used: (e.g. GCC/ICC/MSVC/MINGW/Clang and version)</li>
</ul>
</div>
<div class="section" id="testing-blosc-further">
<h1>Testing Blosc further</h1>
<p>Finally, if you have spare CPU cycles available, you may want to run the
<tt class="docutils literal">hardsuite</tt>, which is a series of tests that are much more comprehensive (and
costly) than the <tt class="docutils literal">suite</tt> above.  The <tt class="docutils literal">hardsuite</tt> will take between 1 and 6
hours to run, depending on your machine and the number of cores, and will
compress/decompress around 4 TB of data.  Running it is easy:</p>
<pre class="code console"><a name="rest_code_2f3b0f29e0724a7f8e6e45043cbf3218-1"></a><span class="gp">$</span> ./bench <span class="sb">`</span>compr<span class="sb">`</span> hardsuite <span class="m">4</span> &gt; myhardsuite.txt
<a name="rest_code_2f3b0f29e0724a7f8e6e45043cbf3218-2"></a><span class="gp">$</span> gzip -9 &lt; myhardsuite.txt &gt; myhardsuite.txt.gz    <span class="c1"># use zip or 7z compressors if on Windows</span>
</pre><p><strong>IMPORTANT</strong>: In order to get fine results, please be sure that you
are not running other heavy process while running the suites.</p>
<p>You can search through the output for the <tt class="docutils literal">FAILED</tt> string in order to see
if something went wrong.  If <tt class="docutils literal">FAILED</tt> does not appear anywhere, you
can be pretty sure that Blosc works well for your platform.  If
failures appear, please report this to <a class="reference external" href="http://groups.google.com/group/blosc">the mailing list</a>.</p>
<p><strong>NOTE</strong>: You cannot use <tt class="docutils literal"><span class="pre">plot-speeds.py</span></tt> to plot the results of the
<tt class="docutils literal">hardsuite</tt>, as it is only meant for plotting <tt class="docutils literal">suite</tt> output purposes.</p>
<p>Incidentally, we have added a new suite called <tt class="docutils literal">extremesuite</tt> that
performs a crazy check on many, many possible inputs to Blosc.  It
works similarly than the <tt class="docutils literal">hardsuite</tt>, but it can take between 2 and 3
days to finish on a relatively recent CPU, and can account up to 60 TB
of data compressed, decompressed and round-trip checked.  Really, this
is not for everyone but in case you are brave enough, you might want
to have it a try.</p>
</div>
